<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JavaClaw ‚Äî Engineering Manager Cockpit (Mock)</title>
  <style>
    :root{--bg:#071007;--line:#134d1d;--text:#b7ffb7;--muted:#79cc79;--accent:#00ff66;--warn:#ffd166;--bad:#ff5c7a;--good:#57ff9a;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 20% 0%,#0b240e 0%,var(--bg) 55%);color:var(--text);font-family:var(--mono);letter-spacing:.2px}
    .app{height:100vh;display:flex;flex-direction:column}
    .topbar{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;border-bottom:1px solid var(--line);background:rgba(0,0,0,.35)}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:10px;height:10px;background:var(--accent);box-shadow:0 0 12px rgba(0,255,102,.6);border-radius:2px}
    .title{font-weight:700}
    .meta{color:var(--muted);font-size:12px}
    .kbd{border:1px solid var(--line);padding:2px 6px;border-radius:6px;color:var(--muted);font-size:12px}
    .main{flex:1;display:grid;grid-template-columns:270px 1fr 320px;gap:10px;padding:10px}
    .panel{background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.05));border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .panelHeader{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);background:rgba(0,0,0,.18)}
    .panelHeader .h{font-weight:700}
    .panelHeader .s{color:var(--muted);font-size:12px}
    .panelBody{padding:10px 12px;overflow:auto;max-height:calc(100vh - 48px - 20px - 44px)}
    .navItem{padding:10px;border:1px solid transparent;border-radius:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .navItem:hover{border-color:var(--line);background:rgba(0,255,102,.04)}
    .navItem.active{border-color:rgba(0,255,102,.35);background:rgba(0,255,102,.06)}
    .badge{font-size:11px;color:var(--bg);background:var(--muted);padding:2px 6px;border-radius:999px}
    .badge.good{background:var(--good)} .badge.warn{background:var(--warn)} .badge.bad{background:var(--bad)}
    .sectionLabel{margin-top:10px;color:var(--muted);font-size:12px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{border:1px solid var(--line);color:var(--muted);padding:3px 8px;border-radius:999px;font-size:12px}
    .chip.accent{border-color:rgba(0,255,102,.35);color:var(--text)}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{background:rgba(0,255,102,.06);border:1px solid rgba(0,255,102,.22);color:var(--text);padding:8px 10px;border-radius:12px;cursor:pointer;font-weight:700;font-size:12px}
    .btn:hover{background:rgba(0,255,102,.10)}
    .btn.primary{background:rgba(0,255,102,.15)}
    .btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
    .card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.18)}
    .cardH{padding:10px 12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .cardB{padding:10px 12px}
    .tiny{font-size:12px;color:var(--muted)}
    textarea{width:100%;min-height:140px;resize:vertical;background:rgba(0,0,0,.25);border:1px solid var(--line);border-radius:12px;color:var(--text);padding:10px;outline:none;line-height:1.25rem}
    .hr{height:1px;background:var(--line);margin:10px 0}
    .table{width:100%;border-collapse:collapse;font-size:12px}
    .table th,.table td{border-bottom:1px solid rgba(19,77,29,.6);padding:8px 6px;text-align:left}
    .table th{color:var(--muted);font-weight:700}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:3px 8px;border-radius:999px;border:1px solid var(--line);color:var(--muted)}
    .pill.good{border-color:rgba(87,255,154,.35);color:var(--good)}
    .pill.bad{border-color:rgba(255,92,122,.35);color:var(--bad)}
    .pill.warn{border-color:rgba(255,209,102,.35);color:var(--warn)}
    .event{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(0,0,0,.10)}
    .event:hover{background:rgba(0,255,102,.04)}
    .eventTop{display:flex;justify-content:space-between;gap:10px}
    .eventTitle{font-weight:700}
    .footer{height:44px;border-top:1px solid var(--line);background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:space-between;padding:0 10px;color:var(--muted);font-size:12px}
    .toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.75);border:1px solid var(--line);color:var(--text);padding:10px 12px;border-radius:12px;display:none;max-width:70vw}
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">JAVACLAW v1.0 <span class="meta">‚Äî manager cockpit mock</span></div>
        <div class="meta">gateway: localhost:8080 ‚Ä¢ mongo: rs0 ‚Ä¢ mode: <span id="mode">testmode</span></div>
      </div>
    </div>
    <div class="row">
      <span class="kbd">F7</span><span class="meta">intake</span>
      <span class="kbd">F3</span><span class="meta">run</span>
      <span class="kbd">F8</span><span class="meta">timers</span>
      <span class="kbd">F12</span><span class="meta">memory</span>
      <button class="btn ghost" id="toggleHelp">F1 Help</button>
    </div>
  </div>

  <div class="main">
    <div class="panel">
      <div class="panelHeader">
        <div><div class="h">NAVIGATOR</div><div class="s">Projects ‚Ä¢ Threads ‚Ä¢ Scenarios</div></div>
        <span class="badge good">LIVE</span>
      </div>
      <div class="panelBody" id="nav">
        <div class="sectionLabel">PROJECTS</div>
        <div class="navItem active" data-view="intake"><span>‚ñ∂ Sprint Tracker</span><span class="badge">ACTIVE</span></div>
        <div class="navItem" data-view="threads"><span>üßµ Threads</span><span class="badge">3</span></div>
        <div class="navItem" data-view="objectives"><span>üéØ Objectives</span><span class="badge">2</span></div>
        <div class="navItem" data-view="plans"><span>üß© Plans</span><span class="badge">1</span></div>
        <div class="navItem" data-view="resources"><span>üë• Resources</span><span class="badge warn">OVERLOAD</span></div>
        <div class="navItem" data-view="links"><span>üîó LinkHub</span><span class="badge">19</span></div>
        <div class="navItem" data-view="checklists"><span>‚òë Checklists</span><span class="badge">4</span></div>
        <div class="navItem" data-view="reconcile"><span>üîÑ Reconcile</span><span class="badge">Œî</span></div>

        <div class="sectionLabel">SCENARIOS</div>
        <div class="navItem" data-view="scenarios"><span>üß™ Scenario Runner</span><span class="badge good">PASS</span></div>
        <div class="navItem" data-view="reports"><span>üìÑ Reports</span><span class="badge">2</span></div>

        <div class="hr"></div>
        <div class="sectionLabel">KEYS</div>
        <div class="chips"><span class="chip">Ctrl+K API keys</span><span class="chip">WS events</span><span class="chip">Mongo change streams</span></div>
      </div>
    </div>

    <div class="panel">
      <div class="panelHeader">
        <div><div class="h" id="centerTitle">INTAKE</div><div class="s" id="centerSub">Paste text or file paths; agents create threads, ideas, plans, reminders, objectives, resourcing updates.</div></div>
        <div class="row"><button class="btn" id="runAgents">Run (F3)</button><button class="btn ghost" id="clear">Clear</button></div>
      </div>
      <div class="panelBody" id="centerBody"></div>
    </div>

    <div class="panel">
      <div class="panelHeader">
        <div><div class="h">AGENTS / ACTIVITY</div><div class="s">controller ‚Üí specialist ‚Üí reviewer</div></div>
        <span class="badge" id="stepBadge">STEP 0</span>
      </div>
      <div class="panelBody">
        <div class="card">
          <div class="cardH"><div><b>Agents</b><div class="tiny">skills + tools</div></div><span class="pill good">OBSERVABLE</span></div>
          <div class="cardB">
            <table class="table"><thead><tr><th>agent</th><th>role</th><th>state</th></tr></thead><tbody id="agentsTable"></tbody></table>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="card">
          <div class="cardH"><div><b>Activity</b><div class="tiny">events + tool stream</div></div><span class="pill warn" id="reviewPill">review: pending</span></div>
          <div class="cardB" id="log"></div>
        </div>
        <div style="height:10px"></div>
        <div class="card">
          <div class="cardH"><div><b>Inspector</b><div class="tiny">selected entity snapshot</div></div></div>
          <div class="cardB" id="inspector"><div class="tiny">Select a thread/objective/plan/scenario item to inspect.</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div>F1 Help ‚Ä¢ F3 Run ‚Ä¢ F7 Intake ‚Ä¢ F8 Timers ‚Ä¢ F10 Agents ‚Ä¢ F11 Search ‚Ä¢ F12 Memory</div>
    <div>Mock UI ‚Ä¢ keyboard-first ‚Ä¢ green-on-black</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  const $ = (q)=>document.querySelector(q);
  const $$ = (q)=>Array.from(document.querySelectorAll(q));

  const state = { view:"intake", step:0, selected:null };

  const agents = [
    {id:"controller", role:"CONTROLLER", state:"IDLE", tools:["route","memory","human_search"]},
    {id:"pm", role:"SPECIALIST", state:"IDLE", tools:["create_ticket","create_idea","excel","memory","read_file"]},
    {id:"coder", role:"SPECIALIST", state:"IDLE", tools:["read_file","write_file","jbang_exec","python_exec","git_diff"]},
    {id:"reviewer", role:"CHECKER", state:"IDLE", tools:["consistency_check"]},
    {id:"distiller", role:"SPECIALIST", state:"IDLE", tools:["memory","summarize"]}
  ];

  const intakeHistory = [
    {ts:"2026-02-18 09:05", title:"Confluence paste: design + minutes", tags:["threads","ideas","objectives"], desc:"Clustered into Thread: 'KYC-SVC Phase 1' and extracted ideas."},
    {ts:"2026-02-18 09:20", title:"Smartsheet dump: PM plan v7", tags:["reconcile","plan"], desc:"Produced delta pack: missing epics, date drift, owner mismatch."},
    {ts:"2026-02-18 09:35", title:"Key dates: ORR checklist due Feb 28", tags:["reminders"], desc:"Created reminders (T-3 days + day-of)."}
  ];

  const threads = [
    {id:"t1", title:"KYC-SVC Phase 1", status:"ACTIVE", evidence:5, ideas:6, updated:"09:08"},
    {id:"t2", title:"Smartsheet ‚Üî Jira Reconcile", status:"ACTIVE", evidence:2, ideas:3, updated:"09:23"},
    {id:"t3", title:"Operational Readiness (ORR)", status:"DRAFT", evidence:1, ideas:2, updated:"09:36"}
  ];

  const objectives = [
    {sprint:"Sprint 3", title:"Ship Phase 1 scaffolding", coverage:72, unmapped:4, risk:"Medium"},
    {sprint:"Sprint 4", title:"Operational readiness + rollout", coverage:35, unmapped:9, risk:"High"}
  ];

  const plan = {
    name:"KYC Modernization ‚Äî Phase Plan",
    phases:[
      {name:"Phase 1 ‚Äî Facade + Tooling", entry:["baseline endpoints","tool registry"], exit:["load test","ORR checklist draft"], date:"Mar 8"},
      {name:"Phase 2 ‚Äî Threaded delivery", entry:["threads stable","objective mapping"], exit:["reconcile automation","ops runbooks"], date:"Apr 12"}
    ]
  };

  const scenarios = [
    {id:"s1", name:"intake‚Üíthreads/objectives", status:"PASS", steps:4, lastRun:"09:45"},
    {id:"s2", name:"reminders parsing", status:"PASS", steps:2, lastRun:"09:46"},
    {id:"s3", name:"smartsheet reconcile", status:"FAIL", steps:3, lastRun:"09:47"}
  ];

  function toast(msg){ const t=$("#toast"); t.textContent=msg; t.style.display="block"; clearTimeout(window.__t); window.__t=setTimeout(()=>t.style.display="none",1800);} 

  function renderAgents(){
    const tbody=$("#agentsTable"); tbody.innerHTML="";
    agents.forEach(a=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${a.id}</td><td>${a.role}</td><td><span class="pill ${a.state==="RUNNING"?"warn":"good"}">${a.state}</span></td>`;
      tr.style.cursor="pointer";
      tr.onclick=()=>{ state.selected={type:"agent", id:a.id}; renderInspector(); };
      tbody.appendChild(tr);
    });
  }

  function log(line, kind="info"){
    const el=document.createElement("div");
    el.className="event";
    const pill=kind==="good"?"pill good":kind==="bad"?"pill bad":kind==="warn"?"pill warn":"pill";
    el.innerHTML=`<div class="eventTop"><div class="eventTitle">${line}</div><span class="${pill}">${kind}</span></div><div class="tiny">event stream (mock)</div>`;
    $("#log").prepend(el);
  }

  function setView(view){
    state.view=view;
    $$("#nav .navItem").forEach(n=>n.classList.toggle("active", n.dataset.view===view));
    if(view==="intake") renderIntake();
    if(view==="threads") renderThreads();
    if(view==="objectives") renderObjectives();
    if(view==="plans") renderPlans();
    if(view==="resources") renderResources();
    if(view==="links") renderLinks();
    if(view==="checklists") renderChecklists();
    if(view==="reconcile") renderReconcile();
    if(view==="scenarios") renderScenarios();
    if(view==="reports") renderReports();
  }

  function renderIntake(){
    $("#centerTitle").textContent="INTAKE";
    $("#centerSub").textContent="Freeform intake: paste text or file paths; agents create threads/ideas/plans/reminders/objectives/resourcing.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Freeform intake</b><div class="tiny">Paste Confluence/Jira/Smartsheet/link dumps OR file paths.</div></div><span class="chip accent">project: Sprint Tracker</span></div>
        <div class="cardB">
          <textarea id="intakeText" placeholder="Intent: threads | ideas | plan | reconcile | resourcing | reminders\n\nPaste here...\n\nFile paths examples:\n- C:\\work\\notes\\phase1.pdf\n- /mnt/c/Users/drom/Downloads/jira.xlsx"></textarea>
          <div class="row" style="margin-top:8px;">
            <button class="btn" data-intent="threads">Create threads</button>
            <button class="btn" data-intent="ideas">Extract ideas</button>
            <button class="btn" data-intent="plan">Propose plan</button>
            <button class="btn" data-intent="objectives">Line up objectives</button>
            <button class="btn" data-intent="resourcing">Update resourcing</button>
            <button class="btn" data-intent="reminders">Create reminders</button>
            <button class="btn" data-intent="reconcile">Reconcile</button>
            <button class="btn primary" id="send">Send</button>
          </div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="card">
        <div class="cardH"><div><b>Recent intake</b><div class="tiny">select to inspect</div></div></div>
        <div class="cardB" id="intakeTL"></div>
      </div>
    `;

    const tl=$("#intakeTL");
    intakeHistory.forEach((i,idx)=>{
      const el=document.createElement("div");
      el.className="event";
      el.innerHTML=`<div class="eventTop"><div style="min-width:0"><div class="eventTitle">${i.title}</div><div class="tiny">${i.ts}</div></div><div class="chips">${i.tags.map(t=>`<span class="chip accent">${t}</span>`).join("")}</div></div><div class="tiny" style="margin-top:6px">${i.desc}</div>`;
      el.onclick=()=>{ state.selected={type:"intake", index:idx}; renderInspector(); };
      tl.appendChild(el);
    });

    $$("button[data-intent]").forEach(b=>b.onclick=(e)=>{
      e.preventDefault();
      const t=$("#intakeText");
      const intent=b.dataset.intent;
      const prefix=`Intent: ${intent}\n`;
      if(!t.value.startsWith("Intent:")) t.value=prefix+t.value;
      toast(`intent set: ${intent}`);
      log(`INTAKE_INTENT: ${intent}`,"info");
    });

    $("#send").onclick=()=>{
      const msg=($("#intakeText").value||"").trim();
      if(!msg){ toast("nothing to send"); return; }
      toast("intake sent (mock)");
      state.step+=1; $("#stepBadge").textContent="STEP "+state.step;
      agents.forEach(a=>a.state="IDLE");
      agents.find(a=>a.id==="controller").state="RUNNING";
      renderAgents();
      log("USER_MESSAGE_RECEIVED","info");
      log("AGENT_DELEGATED ‚Üí pm","warn");
      agents.find(a=>a.id==="pm").state="RUNNING";
      renderAgents();
      log("TOOL_CALL_PROPOSED: excel/read_file/memory (mock)","info");
      log("AGENT_CHECK_PASSED (reviewer)","good");
      $("#reviewPill").className="pill good"; $("#reviewPill").textContent="review: PASS";
      $("#intakeText").value="";
    };
  }

  function renderThreads(){
    $("#centerTitle").textContent="THREADS";
    $("#centerSub").textContent="Threads created from intake clustering (dates + entities).";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Project Threads</b><div class="tiny">select to inspect</div></div><div class="chips"><span class="chip">auto-clustered</span><span class="chip">evidence-backed</span></div></div>
        <div class="cardB">
          <table class="table"><thead><tr><th>title</th><th>status</th><th>evidence</th><th>ideas</th><th>updated</th></tr></thead><tbody id="threadRows"></tbody></table>
        </div>
      </div>
    `;
    const tb=$("#threadRows");
    threads.forEach(t=>{
      const tr=document.createElement("tr");
      tr.style.cursor="pointer";
      tr.innerHTML=`<td>${t.title}</td><td>${t.status}</td><td>${t.evidence}</td><td>${t.ideas}</td><td>${t.updated}</td>`;
      tr.onclick=()=>{ state.selected={type:"thread", id:t.id}; renderInspector(); };
      tb.appendChild(tr);
    });
  }

  function renderObjectives(){
    $("#centerTitle").textContent="OBJECTIVES";
    $("#centerSub").textContent="Sprint objectives with coverage + unmapped tickets.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Sprint Objectives</b><div class="tiny">coverage % + unmapped</div></div></div>
        <div class="cardB"><table class="table"><thead><tr><th>sprint</th><th>objective</th><th>coverage</th><th>unmapped</th><th>risk</th></tr></thead><tbody id="objRows"></tbody></table></div>
      </div>
    `;
    const tb=$("#objRows");
    objectives.forEach((o,idx)=>{
      const tr=document.createElement("tr");
      tr.style.cursor="pointer";
      tr.innerHTML=`<td>${o.sprint}</td><td>${o.title}</td><td>${o.coverage}%</td><td>${o.unmapped}</td><td>${o.risk}</td>`;
      tr.onclick=()=>{ state.selected={type:"objective", index:idx}; renderInspector(); };
      tb.appendChild(tr);
    });
  }

  function renderPlans(){
    $("#centerTitle").textContent="PLANS";
    $("#centerSub").textContent="Phases with entry/exit criteria + milestone dates.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>${plan.name}</b><div class="tiny">generated + editable</div></div><span class="pill good">phases: ${plan.phases.length}</span></div>
        <div class="cardB">
          ${plan.phases.map((p,idx)=>`<div class="event" data-phase="${idx}" style="cursor:pointer"><div class="eventTop"><div class="eventTitle">${p.name}</div><span class="pill warn">milestone: ${p.date}</span></div><div class="tiny" style="margin-top:6px"><b>Entry:</b> ${p.entry.join(", ")}</div><div class="tiny"><b>Exit:</b> ${p.exit.join(", ")}</div></div>`).join("")}
        </div>
      </div>
    `;
    $$("[data-phase]").forEach(el=>el.onclick=()=>{ state.selected={type:"phase", index:+el.dataset.phase}; renderInspector(); });
  }

  function renderResources(){
    $("#centerTitle").textContent="RESOURCES";
    $("#centerSub").textContent="Who is working on what + overload detection.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Team Capacity</b><div class="tiny">allocations roll up to sprint</div></div><span class="pill bad">Bob: 120%</span></div>
        <div class="cardB">
          <table class="table"><thead><tr><th>name</th><th>capacity</th><th>assigned</th><th>status</th></tr></thead><tbody>
            <tr><td>Alice</td><td>100%</td><td>80%</td><td><span class="pill good">OK</span></td></tr>
            <tr><td>Bob</td><td>100%</td><td>120%</td><td><span class="pill bad">OVER</span></td></tr>
            <tr><td>Chen</td><td>100%</td><td>60%</td><td><span class="pill good">OK</span></td></tr>
          </tbody></table>
          <div class="hr"></div>
          <div class="tiny"><b>Agent:</b> flag overload, suggest reassignments, ensure all work maps to objectives.</div>
        </div>
      </div>
    `;
  }

  function renderLinks(){
    $("#centerTitle").textContent="LINKHUB";
    $("#centerSub").textContent="Important links organized by category.";
    const cats=[["Architecture","ADRs, diagrams"],["Minutes","notes + decisions"],["Agendas","prep"],["Non-prod","dev/test"],["Prod","monitoring"],["Repos","git"],["Dev Setup","bootstrap"],["Runbooks","ops"],["ORR Planning","checklists"]];
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>LinkHub</b><div class="tiny">pin + tag links</div></div></div><div class="cardB">${cats.map(c=>`<div class="event"><div class="eventTop"><div class="eventTitle">${c[0]}</div><span class="chip">${c[1]}</span></div><div class="tiny" style="margin-top:6px">‚Ä¢ (mock) pinned link‚Ä¶</div></div>`).join("")}</div></div>`;
  }

  function renderChecklists(){
    $("#centerTitle").textContent="CHECKLISTS";
    $("#centerSub").textContent="Operational readiness + release checklists.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Operational Readiness (ORR)</b><div class="tiny">attach to phases/releases</div></div><span class="pill warn">due: Feb 28</span></div>
        <div class="cardB">
          <div class="tiny">‚òë Runbooks complete</div>
          <div class="tiny">‚òê Alerts defined</div>
          <div class="tiny">‚òê Load test results attached</div>
          <div class="tiny">‚òê Rollback plan reviewed</div>
          <div class="hr"></div>
          <div class="row"><button class="btn">Add item</button><button class="btn">Assign owner</button><button class="btn primary">Generate from phase</button></div>
        </div>
      </div>
    `;
  }

  function renderReconcile(){
    $("#centerTitle").textContent="RECONCILE";
    $("#centerSub").textContent="Align Smartsheet plans to Jira hierarchy.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Smartsheet ‚Üî Jira Delta Pack</b><div class="tiny">agent-produced reconciliation</div></div><span class="pill warn">Œî 7</span></div>
        <div class="cardB">
          <table class="table"><thead><tr><th>delta</th><th>type</th><th>action</th></tr></thead><tbody>
            <tr><td>Epic missing for ‚ÄúEvidence Service‚Äù</td><td>MISSING_TICKET</td><td>Create epic</td></tr>
            <tr><td>Milestone date drift (Mar 8 ‚Üí Mar 15)</td><td>DATE_DRIFT</td><td>Update plan</td></tr>
            <tr><td>Owner mismatch (Alice vs Bob)</td><td>OWNER_MISMATCH</td><td>Resolve</td></tr>
          </tbody></table>
          <div class="hr"></div>
          <div class="row"><button class="btn primary">Apply suggested changes</button><button class="btn">Export report</button></div>
        </div>
      </div>
    `;
  }

  function renderScenarios(){
    $("#centerTitle").textContent="SCENARIO RUNNER";
    $("#centerSub").textContent="Deterministic E2E tests that assert Mongo outcomes (threads/plans/objectives/reminders/resources).";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH"><div><b>Scenarios</b><div class="tiny">schema v2 recommended</div></div><div class="row"><button class="btn primary" id="runSelected">Run selected</button><button class="btn" id="runAll">Run all</button><button class="btn ghost" id="record">Record mode</button></div></div>
        <div class="cardB"><table class="table"><thead><tr><th>name</th><th>status</th><th>steps</th><th>last run</th></tr></thead><tbody id="scRows"></tbody></table><div class="hr"></div><div class="tiny"><b>Assertions:</b> events + Mongo state (coveragePct, reminders.schedule, deltas, overloadCount).</div></div>
      </div>
    `;
    const tb=$("#scRows");
    scenarios.forEach((s,idx)=>{
      const tr=document.createElement("tr"); tr.style.cursor="pointer";
      const pill=s.status==="PASS"?"pill good":s.status==="FAIL"?"pill bad":"pill warn";
      tr.innerHTML=`<td>${s.name}</td><td><span class="${pill}">${s.status}</span></td><td>${s.steps}</td><td>${s.lastRun}</td>`;
      tr.onclick=()=>{ state.selected={type:"scenario", index:idx}; renderInspector(); };
      tb.appendChild(tr);
    });
    $("#runSelected").onclick=()=>{ toast("running selected scenario (mock)"); log("SCENARIO_STEP_STARTED","info"); log("SCENARIO_ASSERT: objectives.coveragePct >= 70","info"); log("SCENARIO_STEP_PASSED","good"); };
    $("#runAll").onclick=()=>{ toast("running all scenarios (mock)"); log("SCENARIO_RUN_STARTED","info"); log("SCENARIO_ASSERT_FAILED: reconcile.deltaCount >= 1 (mock)","bad"); };
    $("#record").onclick=()=>{ toast("record mode (mock)"); log("SCENARIO_RECORD_ENABLED","warn"); };
  }

  function renderReports(){
    $("#centerTitle").textContent="REPORTS";
    $("#centerSub").textContent="Scenario reports (pass/fail + diffs).";
    $("#centerBody").innerHTML=`
      <div class="card"><div class="cardH"><div><b>Latest Reports</b><div class="tiny">stored as JSON artifacts</div></div></div>
      <div class="cardB">
        <div class="event" data-report="0" style="cursor:pointer"><div class="eventTop"><div class="eventTitle">scenario-intake-threads-v2.json</div><span class="pill good">PASS</span></div><div class="tiny">steps: 4 ‚Ä¢ duration: 2.1s</div></div>
        <div class="event" data-report="1" style="cursor:pointer"><div class="eventTop"><div class="eventTitle">scenario-smartsheet-reconcile-v2.json</div><span class="pill bad">FAIL</span></div><div class="tiny">failed: $.reconciliation.deltaCount (expected ‚â• 1)</div></div>
      </div></div>
    `;
    $$("[data-report]").forEach(el=>el.onclick=()=>{ state.selected={type:"report", index:+el.dataset.report}; renderInspector(); });
  }

  function renderInspector(){
    const box=$("#inspector"), sel=state.selected;
    if(!sel){ box.innerHTML='<div class="tiny">Select a thread/objective/plan/scenario item to inspect.</div>'; return; }
    if(sel.type==="agent"){
      const a=agents.find(x=>x.id===sel.id);
      box.innerHTML=`<div><b>Agent:</b> ${a.id}</div><div class="tiny">role: ${a.role}</div><div class="tiny">allowed tools: ${a.tools.join(", ")}</div><div class="hr"></div><div class="tiny"><b>Scenario coverage:</b> add scenarios to validate this agent‚Äôs outputs.</div>`;
      return;
    }
    if(sel.type==="intake"){
      const i=intakeHistory[sel.index];
      box.innerHTML=`<div><b>Intake:</b> ${i.title}</div><div class="tiny">${i.ts}</div><div class="hr"></div><div class="tiny">${i.desc}</div><div class="hr"></div><div class="tiny"><b>Expected outcomes:</b> threads/ideas/objectives/reminders/resourcing updates.</div>`;
      return;
    }
    if(sel.type==="thread"){
      const t=threads.find(x=>x.id===sel.id);
      box.innerHTML=`<div><b>Thread:</b> ${t.title}</div><div class="tiny">status: ${t.status} ‚Ä¢ updated: ${t.updated}</div><div class="hr"></div><div class="tiny">evidenceRefs: ${t.evidence}</div><div class="tiny">ideaIds: ${t.ideas}</div>`;
      return;
    }
    if(sel.type==="objective"){
      const o=objectives[sel.index];
      box.innerHTML=`<div><b>Objective:</b> ${o.sprint}</div><div class="tiny">${o.title}</div><div class="hr"></div><div class="tiny">coveragePct: ${o.coverage}%</div><div class="tiny">unmappedTicketCount: ${o.unmapped}</div><div class="tiny">risk: ${o.risk}</div>`;
      return;
    }
    if(sel.type==="phase"){
      const p=plan.phases[sel.index];
      box.innerHTML=`<div><b>Phase:</b> ${p.name}</div><div class="tiny">milestone: ${p.date}</div><div class="hr"></div><div class="tiny"><b>Entry:</b> ${p.entry.join(", ")}</div><div class="tiny"><b>Exit:</b> ${p.exit.join(", ")}</div>`;
      return;
    }
    if(sel.type==="scenario"){
      const s=scenarios[sel.index];
      box.innerHTML=`<div><b>Scenario:</b> ${s.name}</div><div class="tiny">status: ${s.status} ‚Ä¢ steps: ${s.steps} ‚Ä¢ last run: ${s.lastRun}</div><div class="hr"></div><div class="tiny"><b>Asserts:</b> events + Mongo state (threads/plans/objectives/reminders/resources).</div><div class="hr"></div><div class="tiny">Tip: freeze clock + add toolMocks for excel/read_file.</div>`;
      return;
    }
    if(sel.type==="report"){
      box.innerHTML = sel.index===0 ? `<div><b>Report:</b> scenario-intake-threads-v2.json</div><div class="tiny">PASS ‚Ä¢ assertions: threads.count‚â•1, objective.coveragePct‚â•70</div>` : `<div><b>Report:</b> scenario-smartsheet-reconcile-v2.json</div><div class="tiny"><span class="pill bad">FAIL</span> ‚Ä¢ expected $.reconciliation.deltaCount ‚â• 1</div><div class="hr"></div><div class="tiny"><b>diff:</b> actual deltaCount=0 (mock)</div>`;
    }
  }

  function runAgents(){
    toast("Run (mock)");
    log("AGENT_STEP_STARTED","info");
    agents.forEach(a=>a.state="IDLE");
    agents.find(a=>a.id==="controller").state="RUNNING";
    renderAgents();
    setTimeout(()=>{
      agents.find(a=>a.id==="controller").state="IDLE";
      agents.find(a=>a.id==="pm").state="RUNNING";
      renderAgents();
      log("TOOL_CALL_PROPOSED: memory","info");
      setTimeout(()=>{
        agents.find(a=>a.id==="pm").state="IDLE";
        agents.find(a=>a.id==="reviewer").state="RUNNING";
        renderAgents();
        log("AGENT_CHECK_PASSED","good");
        $("#reviewPill").className="pill good"; $("#reviewPill").textContent="review: PASS";
        agents.find(a=>a.id==="reviewer").state="IDLE";
        renderAgents();
      },450);
    },400);
  }

  $$("#nav .navItem").forEach(n=>n.onclick=()=>setView(n.dataset.view));
  $("#runAgents").onclick=runAgents;
  $("#clear").onclick=()=>{ $("#log").innerHTML=""; toast("cleared"); };
  $("#toggleHelp").onclick=()=>toast("Help: F7 Intake ‚Ä¢ F3 Run ‚Ä¢ Ctrl+K Keys ‚Ä¢ Scenarios assert Mongo outcomes");

  renderAgents();
  renderIntake();
  log("SYSTEM_READY","good");
  renderInspector();
