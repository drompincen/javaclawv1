<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JavaClaw ‚Äî Engineering Manager Cockpit (Mock)</title>
  <style>
    :root{--bg:#071007;--line:#134d1d;--text:#b7ffb7;--muted:#79cc79;--accent:#00ff66;--warn:#ffd166;--bad:#ff5c7a;--good:#57ff9a;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 20% 0%,#0b240e 0%,var(--bg) 55%);color:var(--text);font-family:var(--mono);letter-spacing:.2px;}
    .app{height:100vh;display:flex;flex-direction:column;}
    .topbar{height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;border-bottom:1px solid var(--line);background:rgba(0,0,0,.35);gap:10px;}
    .brand{display:flex;gap:10px;align-items:center;min-width:280px;}
    .logo{width:10px;height:10px;background:var(--accent);box-shadow:0 0 12px rgba(0,255,102,.6);border-radius:2px;}
    .title{font-weight:700}
    .meta{color:var(--muted);font-size:12px}
    .kbd{border:1px solid var(--line);padding:2px 6px;border-radius:6px;color:var(--muted);font-size:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{background:rgba(0,255,102,.06);border:1px solid rgba(0,255,102,.22);color:var(--text);padding:8px 10px;border-radius:12px;cursor:pointer;font-weight:700;font-size:12px;font-family:var(--mono);}
    .btn:hover{background:rgba(0,255,102,.10)}
    .btn.primary{background:rgba(0,255,102,.15)}
    .btn.ghost{background:transparent;border-color:var(--line);color:var(--muted)}
    .select{background:rgba(0,0,0,.25);border:1px solid var(--line);border-radius:12px;color:var(--text);padding:8px 10px;outline:none;font-family:var(--mono);font-size:12px;min-width:220px;}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:3px 8px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px}
    .pill.good{border-color:rgba(87,255,154,.35);color:var(--good)}
    .pill.bad{border-color:rgba(255,92,122,.35);color:var(--bad)}
    .pill.warn{border-color:rgba(255,209,102,.35);color:var(--warn)}
    .main{flex:1;display:grid;grid-template-columns:290px 1fr 380px;gap:10px;padding:10px;}
    .panel{background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.05));border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.35);}
    .panelHeader{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);background:rgba(0,0,0,.18);}
    .panelHeader .h{font-weight:700}
    .panelHeader .s{color:var(--muted);font-size:12px}
    .panelBody{padding:10px 12px;overflow:auto;max-height:calc(100vh - 56px - 20px - 44px);}
    .navItem{padding:10px;border:1px solid transparent;border-radius:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .navItem:hover{border-color:var(--line);background:rgba(0,255,102,.04)}
    .navItem.active{border-color:rgba(0,255,102,.35);background:rgba(0,255,102,.06)}
    .badge{font-size:11px;color:var(--bg);background:var(--muted);padding:2px 6px;border-radius:999px}
    .badge.good{background:var(--good)}
    .badge.warn{background:var(--warn)}
    .badge.bad{background:var(--bad)}
    .tree{display:flex;flex-direction:column;gap:6px}
    .sectionLabel{margin-top:10px;color:var(--muted);font-size:12px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{border:1px solid var(--line);color:var(--muted);padding:3px 8px;border-radius:999px;font-size:12px}
    .chip.accent{border-color:rgba(0,255,102,.35);color:var(--text)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    textarea{width:100%;min-height:160px;resize:vertical;background:rgba(0,0,0,.25);border:1px solid var(--line);border-radius:12px;color:var(--text);padding:10px;outline:none;line-height:1.25rem;font-family:var(--mono);font-size:12px;}
    .card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.18);}
    .cardH{padding:10px 12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .cardB{padding:10px 12px}
    .tiny{font-size:12px;color:var(--muted)}
    .timeline{display:flex;flex-direction:column;gap:8px}
    .event{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(0,0,0,.10)}
    .event:hover{background:rgba(0,255,102,.04)}
    .eventTop{display:flex;justify-content:space-between;gap:10px}
    .eventTitle{font-weight:700}
    .hr{height:1px;background:var(--line);margin:10px 0}
    .table{width:100%;border-collapse:collapse;font-size:12px}
    .table th,.table td{border-bottom:1px solid rgba(19,77,29,.6);padding:8px 6px;text-align:left}
    .table th{color:var(--muted);font-weight:700}
    .footer{height:44px;border-top:1px solid var(--line);background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:space-between;padding:0 10px;color:var(--muted);font-size:12px;}
    .toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.75);border:1px solid var(--line);color:var(--text);padding:10px 12px;border-radius:12px;display:none;max-width:70vw;}
    .agentGrid{display:grid;grid-template-columns:1fr;gap:10px;}
    .agentActions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .toggle{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--line);border-radius:12px;background:rgba(0,0,0,.15);}
    .toggle input{accent-color:var(--accent);}
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">JAVACLAW <span class="meta">‚Äî manager cockpit mock</span></div>
        <div class="meta">gateway: localhost:8080 ‚Ä¢ mongo: rs0 ‚Ä¢ mode: <span id="mode">testmode</span></div>
      </div>
    </div>

    <div style="flex:1;min-width:280px">
      <div class="meta" style="margin-bottom:4px">Project</div>
      <div class="row">
        <select class="select" id="projectSelect"></select>
        <span class="pill warn" id="currentSprintPill">Sprint ?</span>
        <span class="pill" id="lastSprintPill">Last sprint: ?</span>
      </div>
    </div>

    <div class="row">
      <span class="kbd">F7</span><span class="meta">focus intake</span>
      <span class="kbd">F3</span><span class="meta">run controller</span>
      <button class="btn ghost" id="toggleHelp">F1 Help</button>
    </div>
  </div>

  <div class="main">
    <div class="panel">
      <div class="panelHeader">
        <div>
          <div class="h">NAVIGATOR</div>
          <div class="s">Project workspace</div>
        </div>
        <span class="badge good">LIVE</span>
      </div>
      <div class="panelBody">
        <div class="sectionLabel">WORKSPACES</div>
        <div class="tree" id="nav">
          <div class="navItem active" data-view="intake"><span>üì• Intake</span><span class="badge" id="navIntakeBadge">READY</span></div>
          <div class="navItem" data-view="threads"><span>üßµ Threads</span><span class="badge" id="navThreadsBadge">0</span></div>
          <div class="navItem" data-view="objectives"><span>üéØ Objectives</span><span class="badge" id="navObjBadge">0</span></div>
          <div class="navItem" data-view="plans"><span>üß© Plans</span><span class="badge" id="navPlansBadge">0</span></div>
          <div class="navItem" data-view="reminders"><span>‚è± Reminders</span><span class="badge" id="navRemBadge">0</span></div>
          <div class="navItem" data-view="checklists"><span>‚òë Checklists</span><span class="badge" id="navChkBadge">0</span></div>
          <div class="navItem" data-view="reconcile"><span>üîÑ Reconcile</span><span class="badge">Œî</span></div>
          <div class="navItem" data-view="links"><span>üîó LinkHub</span><span class="badge" id="navLinksBadge">0</span></div>
        </div>

        <div class="hr"></div>
        <div class="sectionLabel">HINTS</div>
        <div class="chips">
          <span class="chip">type: <span class="chip accent">use project &lt;name&gt;</span> in intake</span>
          <span class="chip">paste: Confluence/Jira/Smartsheet dumps</span>
          <span class="chip">or: file paths</span>
        </div>
      </div>
    </div>

    <div class="panel" id="center">
      <div class="panelHeader">
        <div>
          <div class="h" id="centerTitle">INTAKE</div>
          <div class="s" id="centerSub">Freeform: paste text or file paths; agents organize into threads, ideas, plans, objectives, reminders, checklists, reconciliation.</div>
        </div>
        <div class="row">
          <button class="btn" id="runController">Run (F3)</button>
          <button class="btn ghost" id="clearLog">Clear log</button>
        </div>
      </div>
      <div class="panelBody" id="centerBody"></div>
    </div>

    <div class="panel">
      <div class="panelHeader">
        <div>
          <div class="h">AGENTS / ACTIVITY</div>
          <div class="s">Kick off on-demand or via timers</div>
        </div>
        <span class="badge" id="stepBadge">STEP 0</span>
      </div>
      <div class="panelBody">
        <div class="agentGrid">
          <div class="card">
            <div class="cardH">
              <div>
                <b>On-demand agent runs</b>
                <div class="tiny">Generate artifacts from current project state</div>
              </div>
            </div>
            <div class="cardB">
              <div class="agentActions">
                <button class="btn" data-run="threadMaker">Thread Agent</button>
                <button class="btn" data-run="pm">PM Agent</button>
                <button class="btn" data-run="planner">Plan Agent</button>
                <button class="btn" data-run="reminder">Reminder Agent</button>
                <button class="btn" data-run="checklist">Checklist Agent</button>
                <button class="btn" data-run="reconcile">Reconcile Agent</button>
                <button class="btn primary" data-run="distill">Distiller</button>
              </div>
              <div class="hr"></div>
              <div class="tiny">Runs operate on project state (threads + latest dumps + tickets/resources). Real system would emit tool calls + persist artifacts.</div>
            </div>
          </div>

          <div class="card">
            <div class="cardH">
              <div>
                <b>Timed runs</b>
                <div class="tiny">Background cadence (mock)</div>
              </div>
              <span class="pill warn" id="timerStatus">timers: off</span>
            </div>
            <div class="cardB">
              <div class="toggle"><input type="checkbox" id="tArtifacts"/><label for="tArtifacts">Every 2h: create/update plans + checklists from threads</label></div>
              <div style="height:8px"></div>
              <div class="toggle"><input type="checkbox" id="tReminders"/><label for="tReminders">Daily 09:00: extract reminders from new intake + threads</label></div>
              <div style="height:8px"></div>
              <div class="toggle"><input type="checkbox" id="tReconcile"/><label for="tReconcile">Mon/Wed/Fri: reconcile objectives ‚Üî milestones ‚Üî ticket dump</label></div>
              <div class="hr"></div>
              <button class="btn" id="applyTimers">Apply timers</button>
            </div>
          </div>

          <div class="card">
            <div class="cardH">
              <div>
                <b>Activity stream</b>
                <div class="tiny">events + tool stream (mock)</div>
              </div>
              <span class="pill" id="reviewPill">review: n/a</span>
            </div>
            <div class="cardB"><div class="timeline" id="log"></div></div>
          </div>

          <div class="card">
            <div class="cardH"><div><b>Inspector</b><div class="tiny">selected entity snapshot</div></div></div>
            <div class="cardB" id="inspector"><div class="tiny">Select a thread/objective/plan/reminder to see details.</div></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">
    <div>F1 Help ‚Ä¢ F3 Run controller ‚Ä¢ F7 Focus intake ‚Ä¢ ‚Äúuse project &lt;name&gt;‚Äù</div>
    <div>Mock UI ‚Ä¢ keyboard-first ‚Ä¢ green-on-black</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  const $ = (q)=>document.querySelector(q);
  const $$ = (q)=>Array.from(document.querySelectorAll(q));

  const projects = [
    {name:"Sprint Tracker",currentSprint:"Sprint 3",currentSprintHealth:"WARN",lastSprint:"Sprint 2",lastSprintHealth:"GOOD",linksCount:19,
      objectives:[
        {sprint:"Sprint 3",title:"Ship Phase 1 scaffolding (KYC-SVC facade + tools)",coverage:72,unmapped:4,risk:"Medium"},
        {sprint:"Sprint 4",title:"Operational readiness + rollout plan",coverage:35,unmapped:9,risk:"High"},
      ],
      plan:{name:"KYC Modernization ‚Äî Phase Plan",phases:[
        {name:"Phase 1 ‚Äî Facade + Tooling",entry:["baseline endpoints","tool registry"],exit:["load test","ORR checklist draft"],date:"Mar 8"},
        {name:"Phase 2 ‚Äî Threaded delivery",entry:["threads stable","objective mapping"],exit:["reconcile automation","ops runbooks"],date:"Apr 12"}
      ]},
      reminders:[
        {title:"ORR checklist due",schedule:"2026-02-28 09:00",kind:"ONE_SHOT"},
        {title:"T-3 days ORR prep",schedule:"2026-02-25 09:00",kind:"ONE_SHOT"}
      ],
      checklists:[{name:"Operational Readiness (ORR)",due:"2026-02-28",items:[
        {t:"Runbooks complete",done:true},{t:"Alerts defined",done:false},{t:"Load test results attached",done:false},{t:"Rollback plan reviewed",done:false},
      ]}],
      threads:[
        {id:"t1",title:"KYC-SVC Phase 1",status:"ACTIVE",evidence:5,ideas:6,objectives:["Sprint 3"],updated:"09:08",createdBy:"thread-agent"},
        {id:"t2",title:"Smartsheet ‚Üî Jira Reconcile",status:"ACTIVE",evidence:2,ideas:3,objectives:["Sprint 3"],updated:"09:23",createdBy:"thread-agent"},
        {id:"t3",title:"Operational Readiness (ORR)",status:"DRAFT",evidence:1,ideas:2,objectives:["Sprint 4"],updated:"09:36",createdBy:"thread-agent"},
      ],
      intakeHistory:[
        {ts:"2026-02-18 09:05",title:"Confluence paste: KYC-SVC design + minutes",tags:["threads","ideas","objectives"],desc:"Thread Agent clustered content and named thread(s) by topic + continuity."},
        {ts:"2026-02-18 09:20",title:"Smartsheet dump: PM plan v7",tags:["reconcile","plan"],desc:"Reconcile Agent produced delta pack: missing epics, date drift, owner mismatch."},
        {ts:"2026-02-18 09:35",title:"Key dates: ORR checklist due Feb 28",tags:["reminders","checklists"],desc:"Reminder + Checklist agents created artifacts + owners placeholders."}
      ]
    },
    {name:"KYC-SVC Buildout",currentSprint:"Sprint 12",currentSprintHealth:"GOOD",lastSprint:"Sprint 11",lastSprintHealth:"WARN",linksCount:11,
      objectives:[{sprint:"Sprint 12",title:"Tool annotation pass + MCP exposure",coverage:81,unmapped:2,risk:"Low"}],
      plan:{name:"Service Delivery Plan",phases:[{name:"Phase A ‚Äî Baseline",entry:["api contract"],exit:["prod checklist"],date:"Mar 1"}]},
      reminders:[],checklists:[],threads:[],intakeHistory:[]
    }
  ];

  const state = {view:"intake",step:0,selected:null,projectIdx:0,timers:{artifacts:false,reminders:false,reconcile:false}};
  const currentProject=()=>projects[state.projectIdx];

  function toast(msg){const t=$("#toast");t.textContent=msg;t.style.display="block";clearTimeout(window.__toastTimer);window.__toastTimer=setTimeout(()=>t.style.display="none",1800);}
  function log(line,kind="info"){const div=document.createElement("div");div.className="event";const badge=kind==="good"?"good":kind==="bad"?"bad":kind==="warn"?"warn":"";div.innerHTML=`<div class="eventTop"><div class="eventTitle">${line}</div><span class="pill ${badge}">${kind}</span></div><div class="tiny">event stream (mock)</div>`;$("#log").prepend(div);}

  function refreshProjectHeader(){const p=currentProject();
    $("#currentSprintPill").textContent=p.currentSprint+" ‚Ä¢ "+(p.currentSprintHealth==="GOOD"?"Healthy":"Watch");
    $("#currentSprintPill").className="pill "+(p.currentSprintHealth==="GOOD"?"good":"warn");
    $("#lastSprintPill").textContent="Last: "+p.lastSprint+" ‚Ä¢ "+(p.lastSprintHealth==="GOOD"?"Healthy":"Watch");
    $("#lastSprintPill").className="pill "+(p.lastSprintHealth==="GOOD"?"good":"warn");
  }
  function refreshNavBadges(){const p=currentProject();
    $("#navThreadsBadge").textContent=p.threads.length;
    $("#navObjBadge").textContent=p.objectives.length;
    $("#navPlansBadge").textContent=(p.plan&&p.plan.phases&&p.plan.phases.length)?"1":"0";
    $("#navRemBadge").textContent=p.reminders.length;
    $("#navChkBadge").textContent=p.checklists.length;
    $("#navLinksBadge").textContent=p.linksCount;
  }
  function setProject(idx){state.projectIdx=idx;$("#projectSelect").value=String(idx);refreshProjectHeader();refreshNavBadges();toast("project set: "+currentProject().name);log("CONTEXT: project="+currentProject().name,"info");state.selected=null;setView(state.view);}
  function renderProjectSelect(){const sel=$("#projectSelect");sel.innerHTML="";projects.forEach((p,i)=>{const o=document.createElement("option");o.value=i;o.textContent=p.name;sel.appendChild(o);});sel.value=String(state.projectIdx);sel.onchange=()=>setProject(parseInt(sel.value,10));refreshProjectHeader();refreshNavBadges();}

  function setView(view){state.view=view;$$('#nav .navItem').forEach(n=>n.classList.toggle('active',n.dataset.view===view));
    if(view==="intake") renderIntake();
    if(view==="threads") renderThreads();
    if(view==="objectives") renderObjectives();
    if(view==="plans") renderPlans();
    if(view==="reminders") renderReminders();
    if(view==="checklists") renderChecklists();
    if(view==="reconcile") renderReconcile();
    if(view==="links") renderLinks();
  }

  function renderIntake(){
    const p=currentProject();
    $("#centerTitle").textContent="INTAKE";
    $("#centerSub").textContent="Paste text or provide file paths. Agents organize into threads, ideas, plans, objectives, reminders, checklists, reconciliation.";
    $("#centerBody").innerHTML=`
      <div class="card">
        <div class="cardH">
          <div><b>Freeform intake</b><div class="tiny">Commands: <span class="chip accent">use project &lt;name&gt;</span></div></div>
          <span class="chip accent">project: ${p.name}</span>
        </div>
        <div class="cardB">
          <textarea id="intakeText" placeholder="Paste Confluence/Jira/Smartsheet/link dumps here...\n\nOr file paths:\n- C:\\work\\notes\\phase1.pdf\n- /mnt/c/Users/drom/Downloads/jira.xlsx\n\nCommand:\nuse project KYC-SVC Buildout"></textarea>
          <div class="row" style="margin-top:8px;">
            <button class="btn" data-intent="threads">Thread Agent</button>
            <button class="btn" data-intent="ideas">Extract ideas</button>
            <button class="btn" data-intent="plan">Create/update plan</button>
            <button class="btn" data-intent="objectives">Align objectives</button>
            <button class="btn" data-intent="reminders">Create reminders</button>
            <button class="btn" data-intent="checklists">Create checklists</button>
            <button class="btn" data-intent="reconcile">Reconcile everything</button>
            <button class="btn primary" id="send">Send</button>
          </div>
        </div>
      </div>
      <div style="height:10px"></div>
      <div class="grid2">
        <div class="card">
          <div class="cardH"><div><b>Recent intake</b><div class="tiny">select to inspect</div></div></div>
          <div class="cardB"><div class="timeline" id="intakeTL"></div></div>
        </div>
        <div class="card">
          <div class="cardH"><div><b>Outcome expectations</b><div class="tiny">what ‚Äúdone‚Äù looks like</div></div></div>
          <div class="cardB">
            <div class="tiny"><b>Thread Agent</b>: names threads by topic + continuity; links to sprint objectives<br/>
            <b>Plan Agent</b>: phases + entry/exit + milestones; maps to epics/initiatives<br/>
            <b>Reminder Agent</b>: normalized schedules; attaches to milestones + checklists<br/>
            <b>Checklist Agent</b>: ORR/release lists; owners; status<br/>
            <b>Reconcile Agent</b>: objectives ‚Üî milestones ‚Üî ticket dump alignment; drift deltas</div>
            <div class="hr"></div>
            <div class="chips"><span class="chip">Mongo change streams</span><span class="chip">Event types</span><span class="chip">Checker loop</span></div>
          </div>
        </div>
      </div>`;

    const tl=$("#intakeTL");
    if(p.intakeHistory.length===0){ tl.innerHTML='<div class="tiny">No intake yet for this project.</div>'; }
    else{
      p.intakeHistory.forEach((i,idx)=>{
        const el=document.createElement('div');el.className='event';
        el.innerHTML=`<div class="eventTop"><div style="min-width:0"><div class="eventTitle">${i.title}</div><div class="tiny">${i.ts}</div></div><div class="chips">${(i.tags||[]).map(t=>`<span class="chip accent">${t}</span>`).join('')}</div></div><div class="tiny" style="margin-top:6px">${i.desc}</div>`;
        el.onclick=()=>{state.selected={type:'intake',index:idx};renderInspector();};
        tl.appendChild(el);
      });
    }

    $$("#centerBody button[data-intent]").forEach(b=>{
      b.onclick=(e)=>{e.preventDefault();const t=$("#intakeText");const intent=b.dataset.intent;const prefix=`Intent: ${intent}\n`;if(!t.value.startsWith('Intent:')) t.value=prefix+t.value;toast('intent set: '+intent);log('INTAKE_INTENT: '+intent,'info');};
    });

    $("#send").onclick=()=>{
      const raw=($("#intakeText").value||'').trim();
      if(!raw){toast('nothing to send');return;}
      const m=raw.match(/^use project\s+(.+)$/i);
      if(m){
        const target=(m[1]||'').trim();
        const idx=projects.findIndex(p=>p.name.toLowerCase()===target.toLowerCase());
        if(idx>=0){setProject(idx);$("#intakeText").value='';return;}
        toast('unknown project: '+target);log('CONTEXT_COMMAND_FAILED: use project '+target,'warn');return;
      }

      toast('intake sent (mock)');state.step+=1;$("#stepBadge").textContent='STEP '+state.step;
      log('USER_MESSAGE_RECEIVED','info');
      log('CONTROLLER: routing to Thread Agent + PM Agent (mock)','warn');
      log('THREAD_AGENT: created/updated threads (mock)','info');
      log('PM_AGENT: updated objectives + plan links (mock)','info');
      log('CHECKER: PASS (mock)','good');
      $("#reviewPill").className='pill good';$("#reviewPill").textContent='review: PASS';
      $("#intakeText").value='';

      p.intakeHistory.unshift({ts:new Date().toISOString().slice(0,16).replace('T',' '),title:'Intake: freeform paste',tags:['threads','ideas','objectives'],desc:'Thread Agent clustered and named threads; PM agent aligned objectives.'});
      if(p.threads.length===0){p.threads.push({id:'tNew',title:'Auto-named: Intake Cluster #1',status:'DRAFT',evidence:1,ideas:1,objectives:[p.currentSprint],updated:'now',createdBy:'thread-agent'});} else {p.threads[0].updated='now';}
      refreshNavBadges();renderIntake();
    };
  }

  function renderThreads(){
    const p=currentProject();
    $("#centerTitle").textContent='THREADS';
    $("#centerSub").textContent='Threads are named + created by the Thread Agent from intake clustering (topic + continuity + dates).';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>Project Threads</b><div class="tiny">createdBy: thread-agent ‚Ä¢ select to inspect</div></div><div class="row"><button class="btn" id="runThreadAgent">Run Thread Agent</button><span class="pill warn">${p.currentSprint}</span></div></div><div class="cardB"><table class="table"><thead><tr><th>title</th><th>status</th><th>evidence</th><th>ideas</th><th>updated</th><th>by</th></tr></thead><tbody id="threadRows"></tbody></table></div></div>`;
    const tbody=$("#threadRows");
    if(p.threads.length===0) tbody.innerHTML='<tr><td colspan="6" class="tiny">No threads yet. Paste content in Intake.</td></tr>';
    else p.threads.forEach(t=>{const tr=document.createElement('tr');tr.style.cursor='pointer';tr.innerHTML=`<td>${t.title}</td><td>${t.status}</td><td>${t.evidence}</td><td>${t.ideas}</td><td>${t.updated}</td><td>${t.createdBy||'?'}</td>`;tr.onclick=()=>{state.selected={type:'thread',id:t.id};renderInspector();};tbody.appendChild(tr);});
    $("#runThreadAgent").onclick=()=>{toast('Thread Agent run (mock)');log('THREAD_AGENT_STARTED','info');log('THREAD_AGENT: normalized titles + merged duplicates (mock)','info');log('THREAD_AGENT_COMPLETED','good');if(p.threads[0]) p.threads[0].title=p.threads[0].title.replace('New Thread (auto-named)','Auto-named: Intake Cluster #1');renderThreads();refreshNavBadges();};
  }

  function renderObjectives(){
    const p=currentProject();
    $("#centerTitle").textContent='OBJECTIVES';
    $("#centerSub").textContent='Sprint objectives with coverage + unmapped tickets; PM agent keeps them aligned.';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>Sprint Objectives</b><div class="tiny">coverage % + unmapped tickets</div></div><div class="row"><button class="btn" id="runPmForObj">Run PM Agent</button><span class="pill warn">${p.currentSprint}</span></div></div><div class="cardB"><table class="table"><thead><tr><th>sprint</th><th>objective</th><th>coverage</th><th>unmapped</th><th>risk</th></tr></thead><tbody id="objRows"></tbody></table></div></div>`;
    const tbody=$("#objRows");
    if(p.objectives.length===0) tbody.innerHTML='<tr><td colspan="5" class="tiny">No objectives yet.</td></tr>';
    else p.objectives.forEach((o,idx)=>{const tr=document.createElement('tr');tr.style.cursor='pointer';tr.innerHTML=`<td>${o.sprint}</td><td>${o.title}</td><td>${o.coverage}%</td><td>${o.unmapped}</td><td>${o.risk}</td>`;tr.onclick=()=>{state.selected={type:'objective',index:idx};renderInspector();};tbody.appendChild(tr);});
    $("#runPmForObj").onclick=()=>{toast('PM Agent: align objectives (mock)');log('PM_AGENT_STARTED','info');log('PM_AGENT: objective‚Üîtickets coverage recomputed (mock)','info');log('PM_AGENT_COMPLETED','good');if(p.objectives[0]) p.objectives[0].coverage=Math.min(100,(p.objectives[0].coverage||0)+3);renderObjectives();};
  }

  function renderPlans(){
    const p=currentProject();const plan=p.plan;
    $("#centerTitle").textContent='PLANS';
    $("#centerSub").textContent='Plans are generated/updated from threads + milestones; Plan Agent keeps phase definitions consistent.';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>${plan?.name||'No plan yet'}</b><div class="tiny">phases + entry/exit criteria</div></div><div class="row"><button class="btn" id="runPlanAgent">Run Plan Agent</button><span class="pill">${(plan?.phases?.length)?('phases: '+plan.phases.length):'phases: 0'}</span></div></div><div class="cardB" id="planBody"></div></div>`;
    const body=$("#planBody");
    if(!plan?.phases?.length) body.innerHTML='<div class="tiny">No plan phases yet. Provide milestones or Smartsheet dump in Intake.</div>';
    else{body.innerHTML=plan.phases.map((ph,idx)=>`<div class="event" style="cursor:pointer" data-phase="${idx}"><div class="eventTop"><div class="eventTitle">${ph.name}</div><span class="pill warn">milestone: ${ph.date}</span></div><div class="tiny" style="margin-top:6px"><b>Entry:</b> ${ph.entry.join(', ')}</div><div class="tiny"><b>Exit:</b> ${ph.exit.join(', ')}</div></div>`).join('');$$("#planBody [data-phase]").forEach(el=>el.onclick=()=>{state.selected={type:'phase',index:+el.dataset.phase};renderInspector();});}
    $("#runPlanAgent").onclick=()=>{toast('Plan Agent run (mock)');log('PLAN_AGENT_STARTED','info');log('PLAN_AGENT: updated phases from new threads + milestones (mock)','info');log('PLAN_AGENT_COMPLETED','good');if(plan?.phases?.[0]) plan.phases[0].exit=Array.from(new Set([...plan.phases[0].exit,'tickets mapped to milestones']));renderPlans();};
  }

  function renderReminders(){
    const p=currentProject();
    $("#centerTitle").textContent='REMINDERS';
    $("#centerSub").textContent='Reminder Agent extracts schedules from intake + milestones; normalizes recurrence.';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>Reminders</b><div class="tiny">normalized schedules</div></div><div class="row"><button class="btn" id="runReminderAgent">Run Reminder Agent</button></div></div><div class="cardB"><table class="table"><thead><tr><th>title</th><th>schedule</th><th>type</th></tr></thead><tbody id="remRows"></tbody></table></div></div>`;
    const tbody=$("#remRows");
    if(p.reminders.length===0) tbody.innerHTML='<tr><td colspan="3" class="tiny">No reminders yet.</td></tr>';
    else p.reminders.forEach((r,idx)=>{const tr=document.createElement('tr');tr.style.cursor='pointer';tr.innerHTML=`<td>${r.title}</td><td>${r.schedule}</td><td>${r.kind}</td>`;tr.onclick=()=>{state.selected={type:'reminder',index:idx};renderInspector();};tbody.appendChild(tr);});
    $("#runReminderAgent").onclick=()=>{toast('Reminder Agent run (mock)');log('REMINDER_AGENT_STARTED','info');log('REMINDER_AGENT: extracted 1 reminder (mock)','info');log('REMINDER_AGENT_COMPLETED','good');p.reminders.unshift({title:'Daily standup prep',schedule:'RRULE:FREQ=DAILY;BYHOUR=8;BYMINUTE=45',kind:'RRULE'});refreshNavBadges();renderReminders();};
  }

  function renderChecklists(){
    const p=currentProject();
    $("#centerTitle").textContent='CHECKLISTS';
    $("#centerSub").textContent='Checklist Agent generates ORR/release checklists from plan phases + operational standards.';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>Checklists</b><div class="tiny">attach to phases/releases</div></div><div class="row"><button class="btn" id="runChecklistAgent">Run Checklist Agent</button></div></div><div class="cardB" id="chkBody"></div></div>`;
    const body=$("#chkBody");
    if(p.checklists.length===0) body.innerHTML='<div class="tiny">No checklists yet.</div>';
    else{body.innerHTML=p.checklists.map((c,idx)=>`<div class="event" style="cursor:pointer" data-chk="${idx}"><div class="eventTop"><div class="eventTitle">${c.name}</div><span class="pill warn">due: ${c.due}</span></div><div class="tiny" style="margin-top:6px">${c.items.filter(i=>i.done).length}/${c.items.length} complete</div></div>`).join('');$$("#chkBody [data-chk]").forEach(el=>el.onclick=()=>{state.selected={type:'checklist',index:+el.dataset.chk};renderInspector();});}
    $("#runChecklistAgent").onclick=()=>{toast('Checklist Agent run (mock)');log('CHECKLIST_AGENT_STARTED','info');log('CHECKLIST_AGENT: created release checklist from plan (mock)','info');log('CHECKLIST_AGENT_COMPLETED','good');p.checklists.unshift({name:'Release Checklist',due:'TBD',items:[{t:'Version bump + tag',done:false},{t:'Runbook verified',done:false},{t:'Alerts green',done:false}]});refreshNavBadges();renderChecklists();};
  }

  function renderReconcile(){
    $("#centerTitle").textContent='RECONCILE';
    $("#centerSub").textContent='Reconcile Agent aligns objectives ‚Üî milestones ‚Üî ticket dump and produces delta pack.';
    $("#centerBody").innerHTML=`<div class="card"><div class="cardH"><div><b>Delta Pack</b><div class="tiny">smartsheet ‚Üî jira ‚Üî objectives ‚Üî milestones</div></div><div class="row"><button class="btn" id="runReconcileAgent">Run Reconcile Agent</button></div></div><div class="cardB"><table class="table"><thead><tr><th>delta</th><th>type</th><th>action</th></tr></thead><tbody><tr><td>Epic missing for ‚ÄúEvidence Service‚Äù</td><td>MISSING_TICKET</td><td>Create epic</td></tr><tr><td>Milestone date drift (Mar 8 ‚Üí Mar 15)</td><td>DATE_DRIFT</td><td>Update plan</td></tr><tr><td>Owner mismatch (Alice vs Bob)</td><td>OWNER_MISMATCH</td><td>Resolve</td></tr></tbody></table></div></div>`;
    $("#runReconcileAgent").onclick=()=>{toast('Reconcile Agent run (mock)');log('RECONCILE_AGENT_STARTED','info');log('RECONCILE_AGENT: computed drift + gaps (mock)','warn');log('RECONCILE_AGENT_COMPLETED','good');};
  }

  function renderLinks(){
    $("#centerTitle").textContent='LINKHUB';
    $("#centerSub").textContent='Important links organized by category.';
    $("#centerBody").innerHTML=`<div class="grid2">${[
      ['Architecture','Latest diagrams, ADRs, design docs'],['Minutes','Meeting notes + decisions'],['Agendas','Upcoming sessions + prep'],['Non-prod','Dev/Test endpoints, dashboards'],['Prod','Production links + monitoring'],['Repos','Git repos + branches'],['Dev Setup','New developer bootstrap'],['Runbooks','Operational procedures'],['ORR Planning','Operational readiness checklists']
    ].map(([t,d])=>`<div class="card"><div class="cardH"><div><b>${t}</b><div class="tiny">${d}</div></div></div><div class="cardB"><div class="tiny">‚Ä¢ (mock) pinned links‚Ä¶</div><div class="tiny">‚Ä¢ (mock) pinned links‚Ä¶</div></div></div>`).join('')}</div>`;
  }

  function renderInspector(){
    const p=currentProject();const box=$("#inspector");const sel=state.selected;
    if(!sel){box.innerHTML='<div class="tiny">Select a thread/objective/plan/reminder to see details.</div>';return;}
    if(sel.type==='intake'){const i=p.intakeHistory[sel.index];box.innerHTML=`<div><b>Intake</b></div><div class="tiny">${i.ts}</div><div class="hr"></div><div class="tiny"><b>${i.title}</b></div><div class="tiny">${i.desc}</div>`;return;}
    if(sel.type==='thread'){const t=p.threads.find(x=>x.id===sel.id);if(!t){box.innerHTML='<div class="tiny">Thread not found.</div>';return;}box.innerHTML=`<div><b>Thread</b>: ${t.title}</div><div class="tiny">status: ${t.status} ‚Ä¢ updated: ${t.updated} ‚Ä¢ createdBy: ${t.createdBy}</div><div class="hr"></div><div class="tiny">evidenceRefs: ${t.evidence}</div><div class="tiny">ideaIds: ${t.ideas}</div><div class="tiny">objectives: ${(t.objectives||[]).join(', ')}</div><div class="hr"></div><div class="tiny"><b>Timer impact:</b> plan/reminder/checklist agents can run on cadence to keep artifacts fresh.</div>`;return;}
    if(sel.type==='objective'){const o=p.objectives[sel.index];box.innerHTML=`<div><b>Objective</b>: ${o.sprint}</div><div class="tiny">${o.title}</div><div class="hr"></div><div class="tiny">coveragePct: ${o.coverage}%</div><div class="tiny">unmappedTicketCount: ${o.unmapped}</div><div class="tiny">risk: ${o.risk}</div>`;return;}
    if(sel.type==='phase'){const ph=p.plan?.phases?.[sel.index];box.innerHTML=`<div><b>Phase</b>: ${ph.name}</div><div class="tiny">milestone: ${ph.date}</div><div class="hr"></div><div class="tiny"><b>Entry</b>: ${ph.entry.join(', ')}</div><div class="tiny"><b>Exit</b>: ${ph.exit.join(', ')}</div>`;return;}
    if(sel.type==='reminder'){const r=p.reminders[sel.index];box.innerHTML=`<div><b>Reminder</b></div><div class="tiny">${r.title}</div><div class="hr"></div><div class="tiny">schedule: ${r.schedule}</div><div class="tiny">type: ${r.kind}</div>`;return;}
    if(sel.type==='checklist'){const c=p.checklists[sel.index];box.innerHTML=`<div><b>Checklist</b></div><div class="tiny">${c.name} ‚Ä¢ due: ${c.due}</div><div class="hr"></div>${(c.items||[]).map(it=>`<div class=\"tiny\">${it.done?'‚òë':'‚òê'} ${it.t}</div>`).join('')}`;return;}
    box.innerHTML='<div class="tiny">No inspector for this selection.</div>';
  }

  function wireAgentButtons(){
    $$('[data-run]').forEach(btn=>{
      btn.onclick=()=>{
        const which=btn.dataset.run;toast(which+' started (mock)');log(which.toUpperCase()+'_STARTED','info');
        if(which==='threadMaker') setView('threads');
        if(which==='pm') setView('objectives');
        if(which==='planner') setView('plans');
        if(which==='reminder') setView('reminders');
        if(which==='checklist') setView('checklists');
        if(which==='reconcile') setView('reconcile');
        if(which==='distill') log('DISTILLER: stored THREAD memories (mock)','good');
        log(which.toUpperCase()+'_COMPLETED','good');
      };
    });

    $("#applyTimers").onclick=()=>{
      state.timers.artifacts=$("#tArtifacts").checked;
      state.timers.reminders=$("#tReminders").checked;
      state.timers.reconcile=$("#tReconcile").checked;
      const any=state.timers.artifacts||state.timers.reminders||state.timers.reconcile;
      $("#timerStatus").textContent=any?'timers: on':'timers: off';
      $("#timerStatus").className='pill '+(any?'warn':'');
      toast('timers updated (mock)');
      log('TIMERS_UPDATED: '+JSON.stringify(state.timers),'info');
    };
  }

  function runController(){toast('controller run (mock)');state.step+=1;$("#stepBadge").textContent='STEP '+state.step;log('AGENT_STEP_STARTED','info');log('CONTROLLER: chose agents {thread-agent, pm-agent, planner} (mock)','warn');log('CHECKER: PASS (mock)','good');$("#reviewPill").className='pill good';$("#reviewPill").textContent='review: PASS';}

  // init
  $$("#nav .navItem").forEach(n=>n.onclick=()=>setView(n.dataset.view));
  $("#runController").onclick=runController;
  $("#clearLog").onclick=()=>{$("#log").innerHTML='';toast('log cleared');};
  $("#toggleHelp").onclick=()=>toast('F3 run controller ‚Ä¢ Intake: use project <name> ‚Ä¢ Right pane: run agents on-demand + timers');

  renderProjectSelect();
  wireAgentButtons();
  setView('intake');
  log('SYSTEM_READY','good');
  renderInspector();
