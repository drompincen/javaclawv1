{
  "schemaVersion": 2,
  "projectName": "Thread Merge via REST Test",
  "description": "Seed 2 threads, ask agent to merge them, verify session completes successfully",
  "defaults": {
    "maxWaitMs": 30000
  },
  "steps": [
    {
      "name": "Seed 2 threads with content",
      "type": "seed",
      "seedActions": [
        {
          "method": "POST",
          "url": "/api/projects/{{projectId}}/threads",
          "body": {
            "title": "Payment Architecture",
            "content": "Architecture decisions for payment service using Kafka and PostgreSQL."
          }
        },
        {
          "method": "POST",
          "url": "/api/projects/{{projectId}}/threads",
          "body": {
            "title": "Payment Implementation Notes",
            "content": "Implementation details for payment service endpoints and testing."
          }
        }
      ]
    },
    {
      "name": "Ask agent to merge payment threads",
      "userQuery": "Merge the two payment threads into one thread called 'Payment Architecture & Implementation'.",
      "toolMocks": [
        {
          "tool": "merge_threads",
          "match": {"type": "any"},
          "result": {"success": true, "output": {"mergedThreadId": "mock-merged-id", "sourceCount": 2, "totalMessages": 0}}
        }
      ],
      "agentResponses": [
        {
          "agentName": "controller",
          "responseFallback": "{\"delegate\": \"pm\", \"subTask\": \"merge payment threads\"}"
        },
        {
          "agentName": "pm",
          "responseFallback": "Let me find the payment threads.\n\n<tool_call>\n{\"name\": \"read_threads\", \"args\": {\"projectId\": \"{{projectId}}\"}}\n</tool_call>"
        },
        {
          "agentName": "pm",
          "responseFallback": "Found 2 payment threads. Merging them now.\n\n<tool_call>\n{\"name\": \"merge_threads\", \"args\": {\"sourceThreadIds\": [\"thread-a\", \"thread-b\"], \"targetTitle\": \"Payment Architecture & Implementation\", \"reason\": \"Consolidating payment threads\"}}\n</tool_call>"
        },
        {
          "agentName": "pm",
          "responseFallback": "Done! Merged 2 payment threads into 'Payment Architecture & Implementation'."
        },
        {
          "agentName": "reviewer",
          "responseFallback": "{\"pass\": true, \"summary\": \"PM merged 2 payment threads into one consolidated thread.\"}"
        }
      ],
      "expects": {
        "sessionStatus": "COMPLETED"
      }
    }
  ]
}
