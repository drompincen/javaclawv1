{
  "schemaVersion": 2,
  "projectName": "Story 1 — Memory-First Intake",
  "description": "Tests memory-first intake: raw content saved as memory, triage classifies 3 topics with routing block, thread agent creates 3 threads with distilled content",
  "defaults": {
    "maxWaitMs": 60000
  },
  "steps": [
    {
      "name": "First intake — 3 topics from meeting notes",
      "type": "pipeline",
      "pipelineContent": "Meeting: Payment Service Architecture Review\nDate: 2026-02-15\nAttendees: Alice, Bob, Charlie\n\n1. Payment Service Architecture\n- Agreed to use event-driven architecture with Kafka\n- Decision: PostgreSQL for primary store, Redis for caching\n- Bob to set up Kafka cluster by Friday\n- Open question: gRPC or REST for inter-service calls?\n\n2. Evidence Service Design\n- Store evidence in S3 with metadata in MongoDB\n- Charlie to write the evidence API spec by next Wednesday\n- Decision: use versioned document model\n- Question: how do we handle evidence expiry?\n\n3. Operational Readiness Review\n- Need ORR checklist before go-live\n- Alice to create the ORR template\n- Decision: target go-live date is March 15\n- Must have monitoring dashboards ready",
      "agentResponses": [
        {
          "agentName": "intake-triage",
          "responseFallback": "Classifying content.\n\n<tool_call>\n{\"name\": \"classify_content\", \"args\": {\"content\": \"Meeting: Payment Service Architecture Review — 3 topics: payment architecture, evidence service, ORR\"}}\n</tool_call>"
        },
        {
          "agentName": "intake-triage",
          "responseFallback": "Content classified as **MEETING_NOTES** (confidence: 0.95)\n\n### Topic: Payment Service Architecture\n**Type:** architecture_decision\n**Decisions:** Event-driven architecture with Kafka, PostgreSQL primary store, Redis caching\n**Open Questions:** gRPC or REST for inter-service calls?\n**Action Items:** Bob to set up Kafka cluster by Friday\n**Key Content:** Architecture decisions for payment service — Kafka event-driven, PostgreSQL + Redis.\n\n### Topic: Evidence Service Design\n**Type:** architecture_decision\n**Decisions:** S3 storage with MongoDB metadata, versioned document model\n**Open Questions:** How to handle evidence expiry?\n**Action Items:** Charlie to write evidence API spec by next Wednesday\n**Key Content:** Evidence collection and storage design with S3 and MongoDB.\n\n### Topic: Operational Readiness Review\n**Type:** action_item\n**Decisions:** Target go-live date March 15\n**Action Items:** Alice to create ORR template, set up monitoring dashboards\n**Key Content:** Pre-launch ORR requirements and checklist needs.\n\n### Routes\nTHREAD: yes\nTICKETS: no\nPLAN: no\nRESOURCES: no"
        },
        {
          "agentName": "generalist",
          "responseFallback": "Creating threads from classified topics.\n\n<tool_call>\n{\"name\": \"create_thread\", \"args\": {\"projectId\": \"{{projectId}}\", \"title\": \"Payment Service Architecture\", \"content\": \"## Payment Service Architecture\\n\\nArchitecture decisions for the payment service first phase.\\n\\n**Decisions:**\\n- Event-driven architecture with Kafka\\n- PostgreSQL for primary store, Redis for caching\\n\\n**Open Questions:**\\n- gRPC or REST for inter-service calls?\\n\\n**Action Items:**\\n- Bob to set up Kafka cluster by Friday\", \"decisions\": [\"Event-driven architecture with Kafka\", \"PostgreSQL primary store, Redis caching\"], \"actions\": [{\"text\": \"Set up Kafka cluster by Friday\", \"assignee\": \"Bob\"}]}}\n</tool_call>\n<tool_call>\n{\"name\": \"create_thread\", \"args\": {\"projectId\": \"{{projectId}}\", \"title\": \"Evidence Service Design\", \"content\": \"## Evidence Service Design\\n\\nEvidence collection and storage design.\\n\\n**Decisions:**\\n- Store evidence in S3 with metadata in MongoDB\\n- Use versioned document model\\n\\n**Open Questions:**\\n- How to handle evidence expiry?\\n\\n**Action Items:**\\n- Charlie to write evidence API spec by next Wednesday\", \"decisions\": [\"S3 storage with MongoDB metadata\", \"Versioned document model\"], \"actions\": [{\"text\": \"Write evidence API spec by next Wednesday\", \"assignee\": \"Charlie\"}]}}\n</tool_call>\n<tool_call>\n{\"name\": \"create_thread\", \"args\": {\"projectId\": \"{{projectId}}\", \"title\": \"Operational Readiness Review\", \"content\": \"## Operational Readiness Review\\n\\nPre-launch operational readiness requirements.\\n\\n**Decisions:**\\n- Target go-live date: March 15\\n\\n**Action Items:**\\n- Alice to create ORR template\\n- Set up monitoring dashboards\\n- Create runbook for incident response\", \"decisions\": [\"Target go-live date March 15\"], \"actions\": [{\"text\": \"Create ORR template\", \"assignee\": \"Alice\"}]}}\n</tool_call>"
        },
        {
          "agentName": "generalist",
          "responseFallback": "Created 3 threads:\n1. **Payment Service Architecture** — Kafka event-driven, PostgreSQL + Redis\n2. **Evidence Service Design** — S3 storage, versioned documents\n3. **Operational Readiness Review** — March 15 go-live, ORR checklist"
        }
      ],
      "expects": {
        "sessionStatus": "COMPLETED",
        "mongo": [
          {
            "collection": "memories",
            "filter": {"projectId": "{{projectId}}", "tags": "intake"},
            "assert": {"countGte": 1}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"countEq": 3}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"anyMatchField": "title", "anyMatchPattern": "Payment Service Architecture"}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"anyMatchField": "title", "anyMatchPattern": "Evidence Service Design"}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"anyMatchField": "title", "anyMatchPattern": "Operational Readiness"}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"anyMatchField": "content", "anyMatchPattern": "event-driven"}
          },
          {
            "collection": "threads",
            "filter": {"projectIds": "{{projectId}}"},
            "assert": {"anyMatchField": "content", "anyMatchPattern": "S3"}
          }
        ]
      }
    }
  ]
}
