<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JavaClaw — Engineering Manager Cockpit</title>
  <link rel="stylesheet" href="css/cockpit.css"/>
</head>
<body>
<div class="app">

  <!-- ── Topbar ── -->
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">JAVACLAW <span class="meta">— manager cockpit</span></div>
        <div class="meta">gateway: localhost:8080 &bull; mongo: rs0</div>
      </div>
    </div>

    <div style="flex:1;min-width:280px">
      <div class="meta" style="margin-bottom:4px">Project</div>
      <div class="row">
        <select class="select" id="projectSelect">
          <option value="">— loading —</option>
        </select>
        <button class="btn ghost" id="shareProject" title="Copy shareable link" style="display:none;padding:6px 8px">&#x1F517;</button>
      </div>
    </div>

    <div class="row">
      <span id="wsBadge" class="badge bad">WS OFF</span>
      <span class="kbd">F7</span><span class="meta">focus intake</span>
      <span class="kbd">F3</span><span class="meta">run controller</span>
      <button class="btn ghost" id="toggleHelp">F1 Help</button>
    </div>
  </div>

  <!-- ── 3-column main ── -->
  <div class="main">

    <!-- Left: Navigator -->
    <div class="panel">
      <div class="panelHeader">
        <div>
          <div class="h">NAVIGATOR</div>
          <div class="s">Project workspace</div>
        </div>
        <span class="badge good">LIVE</span>
      </div>
      <div class="panelBody">
        <div class="sectionLabel">WORKSPACES</div>
        <div class="tree" id="nav"></div>
        <div class="hr"></div>
        <div class="sectionLabel">HINTS</div>
        <div class="chips">
          <span class="chip">type: <span class="chip accent">use project &lt;name&gt;</span> in intake</span>
          <span class="chip">paste: Confluence/Jira/Smartsheet dumps</span>
          <span class="chip">or: file paths</span>
        </div>
      </div>
    </div>

    <!-- Center: Content -->
    <div class="panel" id="center">
      <div class="panelHeader">
        <div>
          <div class="h" id="centerTitle">INTAKE</div>
          <div class="s" id="centerSub">Freeform: paste text or file paths; agents organize into threads, ideas, plans, objectives, reminders, checklists, reconciliation.</div>
        </div>
        <div class="row">
          <button class="btn" id="runController">Run (F3)</button>
        </div>
      </div>
      <div class="panelBody" id="centerBody"></div>
    </div>

    <!-- Right: Agents / Activity -->
    <div class="panel">
      <div class="panelHeader">
        <div>
          <div class="h">AGENTS / ACTIVITY</div>
          <div class="s">Kick off on-demand or via timers</div>
        </div>
        <span class="badge" id="stepBadge">STEP 0</span>
      </div>
      <div class="panelBody">
        <div class="agentGrid">

          <!-- On-demand agent runs -->
          <div class="card">
            <div class="cardH">
              <div>
                <b>On-demand agent runs</b>
                <div class="tiny">Generate artifacts from current project state</div>
              </div>
            </div>
            <div class="cardB">
              <div class="agentActions" id="agentButtons"></div>
              <div class="hr"></div>
              <div class="tiny">Runs operate on project state (threads + latest dumps + tickets/resources). Real system emits tool calls + persists artifacts.</div>
            </div>
          </div>

          <!-- Timed runs -->
          <div class="card">
            <div class="cardH">
              <div>
                <b>Timed runs</b>
                <div class="tiny">Background cadence</div>
              </div>
              <span class="pill warn" id="timerStatus">timers: off</span>
            </div>
            <div class="cardB">
              <div class="toggle"><input type="checkbox" id="tArtifacts"/><label for="tArtifacts">Every 2h: create/update plans + checklists from threads</label></div>
              <div style="height:8px"></div>
              <div class="toggle"><input type="checkbox" id="tReminders"/><label for="tReminders">Daily 09:00: extract reminders from new intake + threads</label></div>
              <div style="height:8px"></div>
              <div class="toggle"><input type="checkbox" id="tReconcile"/><label for="tReconcile">Mon/Wed/Fri: reconcile objectives ↔ milestones ↔ ticket dump</label></div>
              <div class="hr"></div>
              <button class="btn" id="applyTimers">Apply timers</button>
            </div>
          </div>

          <!-- Agent Status -->
          <div class="card">
            <div class="cardH">
              <div>
                <b>Agent Status</b>
                <div class="tiny">live agent activity</div>
              </div>
            </div>
            <div class="cardB"><div class="agentStatusGrid" id="log"></div></div>
          </div>

          <!-- Inspector -->
          <div class="card">
            <div class="cardH"><div><b>Inspector</b><div class="tiny">selected entity snapshot</div></div></div>
            <div class="cardB" id="inspector"><div class="tiny">Select a thread/objective/plan/reminder to see details.</div></div>
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- ── Footer ── -->
  <div class="footer">
    <div>F1 Help &bull; F3 Run controller &bull; F7 Focus intake &bull; "use project &lt;name&gt;"</div>
    <div><span id="tokenCount">&#x1FA99; 0 tokens | 0 calls | avg 0ms</span> &bull; keyboard-first &bull; green-on-black</div>
  </div>

</div>

<div class="toast" id="toast"></div>

<!-- Help modal (F1) -->
<div class="help-overlay" id="helpOverlay" style="display:none">
  <div class="help-modal">
    <h2>Keyboard Shortcuts</h2>
    <div class="help-section">
      <div class="help-section-title">Navigation</div>
      <div class="help-row"><span class="help-key">F1</span><span class="help-desc">Toggle this help</span></div>
      <div class="help-row"><span class="help-key">F7</span><span class="help-desc">Focus intake textarea</span></div>
      <div class="help-row"><span class="help-key">F3</span><span class="help-desc">Run controller agent</span></div>
      <div class="help-row"><span class="help-key">Esc</span><span class="help-desc">Close modal / deselect</span></div>
    </div>
    <div class="help-section">
      <div class="help-section-title">Projects</div>
      <div class="help-row"><span class="help-key">N</span><span class="help-desc">New project (when not in text field)</span></div>
      <div class="help-row"><span class="help-key">—</span><span class="help-desc">Or type <code style="color:var(--accent)">use project &lt;name&gt;</code> in intake</span></div>
    </div>
    <div class="help-section">
      <div class="help-section-title">Intake</div>
      <div class="help-row"><span class="help-key">Ctrl+Enter</span><span class="help-desc">Send intake to pipeline</span></div>
      <div class="help-row"><span class="help-key">Enter</span><span class="help-desc">Submit Ask Claw question</span></div>
    </div>
    <div class="help-section">
      <div class="help-section-title">Views</div>
      <div class="help-row"><span class="help-key">Click row</span><span class="help-desc">Select / expand detail</span></div>
      <div class="help-row"><span class="help-key">Click again</span><span class="help-desc">Deselect / collapse</span></div>
    </div>
    <div style="text-align:right;margin-top:10px"><button class="btn ghost" id="helpClose">Close (Esc)</button></div>
  </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
